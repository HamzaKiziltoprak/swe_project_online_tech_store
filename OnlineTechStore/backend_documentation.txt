# OnlineTechStore Backend Documentation

This document provides a technical overview of the backend for the OnlineTechStore project.

## 1. Project Overview

The backend is built with ASP.NET Core and is responsible for handling business logic, data storage, and providing a RESTful API for the client application.

- **Project File:** `OnlineTechStore.Server.csproj`
- **Main Source Folder:** `OnlineTechStore.Server/`

## 2. Core Technologies

- **Framework:** ASP.NET Core
- **Authentication:** ASP.NET Core Identity with JSON Web Tokens (JWT)
- **Database:** Entity Framework Core with PostgreSQL
- **API:** RESTful API

## 3. Project Structure

- **/Controllers:** Contains API controllers that handle incoming HTTP requests.
  - `AuthController.cs`: Manages user registration and login.
- **/Data:** Contains the Entity Framework Core DbContext.
  - `OnlineTechStoreDbContext.cs`: Defines the database schema and tables.
- **/Models:** Contains the data models (entities) for the application.
  - `ApplicationUser.cs`: Custom user model inheriting from `IdentityUser`.
  - `Product.cs`, `Order.cs`, `Category.cs`, etc.: Other data models.
- **/Migrations:** Contains database migration files generated by EF Core.
- `Program.cs`: The main entry point of the application. It configures services (like Identity, DbContext, JWT) and the HTTP request pipeline (middleware).
- `appsettings.json`: Configuration file for the application, including database connection strings and JWT settings.

## 4. Authentication and Authorization

The application uses a token-based authentication system.

- **Framework:** `ASP.NET Core Identity` is used for user management (password hashing, etc.).
- **Tokens:** `JSON Web Tokens (JWT)` are used for authenticating API requests.

### Authentication Flow:
1. A new user registers via the `/api/auth/register` endpoint.
2. The user logs in via the `/api/auth/login` endpoint with their email and password.
3. If the credentials are valid, the server returns a JWT.
4. The client application must include this JWT in the `Authorization` header for subsequent requests to protected API endpoints (e.g., `Authorization: Bearer <token>`).

### Auth Controller (`/api/auth`):
- **`POST /register`**:
  - **Body:** `{ "email": "...", "password": "...", "firstName": "...", "lastName": "..." }`
  - **Description:** Creates a new user in the database.
- **`POST /login`**:
  - **Body:** `{ "email": "...", "password": "..." }`
  - **Description:** Authenticates a user and returns a JWT if successful.

### JWT Configuration (`appsettings.json`):
The JWT settings are stored in the `Jwt` section:
- `Issuer`: The token issuer.
- `Audience`: The token audience.
- `Key`: The secret key used to sign the tokens. **Note:** This should be stored securely in a production environment.

## 5. Database

- The application uses **Entity Framework Core** as its Object-Relational Mapper (ORM).
- The database provider is **Npgsql** for **PostgreSQL**.
- The connection string is configured in `appsettings.json` under `ConnectionStrings:DefaultConnection`.
- The `OnlineTechStoreDbContext` class in the `/Data` folder defines the database sets (`DbSet`) for the models. ASP.NET Core Identity tables (`AspNetUsers`, `AspNetRoles`, etc.) are also managed through this context.

## 6. How to Run the Backend

1. Make sure the PostgreSQL database is accessible with the connection string in `appsettings.json`.
2. Navigate to the root directory of the solution.
3. Run the command: `dotnet run --project OnlineTechStore.Server`
4. The API will be available at the URLs specified in `Properties/launchSettings.json` (e.g., `https://localhost:7111`).
